# üìä Data Engine Specifications

> –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó –≤ —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–π data engine

---

## –û–≥–ª—è–¥

–¶—è –ø–∞–ø–∫–∞ –º—ñ—Å—Ç–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ñ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –≤—Å—ñ—Ö –º–µ—Ç—Ä–∏–∫, —Ñ–æ—Ä–º—É–ª —Ç–∞ –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤ —Å–∏—Å—Ç–µ–º–∏ GEO (Generative Engine Optimization) –¥–ª—è –º–µ–¥–∏—á–Ω–∏—Ö –∫–ª—ñ–Ω—ñ–∫.

### –ú–µ—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó

1. **–Ü–∑–æ–ª—è—Ü—ñ—è –ª–æ–≥—ñ–∫–∏** ‚Äî –≤—ñ–¥–æ–∫—Ä–µ–º–∏—Ç–∏ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É –≤—ñ–¥ UI —Ç–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
2. **–ú–æ–¥—É–ª—å–Ω—ñ—Å—Ç—å** ‚Äî –∫–æ–∂–µ–Ω –º–æ–¥—É–ª—å –º–∞—î –±—É—Ç–∏ –Ω–µ–∑–∞–ª–µ–∂–Ω–∏–º —Ç–∞ —Ç–µ—Å—Ç–æ–≤–∞–Ω–∏–º
3. **–ü–æ–≤–Ω–æ—Ç–∞** ‚Äî –≤—Å—ñ —Ñ–æ—Ä–º—É–ª–∏, –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ —Ç–∞ edge cases –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤–∞–Ω—ñ
4. **–ú—ñ–≥—Ä–∞—Ü—ñ—è** ‚Äî –ø–æ–ª–µ–≥—à–∏—Ç–∏ –ø–µ—Ä–µ–Ω–æ—Å –≤ –Ω–æ–≤–∏–π –ø—Ä–æ–µ–∫—Ç

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó

| –§–∞–π–ª | –ú–æ–¥—É–ª—å | –û–ø–∏—Å |
|------|--------|------|
| [_template.md](./_template.md) | ‚Äî | –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤–∏—Ö —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ–π |
| [01-clinic-ai-score.md](./01-clinic-ai-score.md) | `clinic-ai-score.ts` | –ì–æ–ª–æ–≤–Ω–∏–π –ø–æ–∫–∞–∑–Ω–∏–∫ –∫–ª—ñ–Ω—ñ–∫–∏ |
| [02-aiv-score.md](./02-aiv-score.md) | `aiv-score.ts` | –ü–æ–∫–∞–∑–Ω–∏–∫ –≤–∏–¥–∏–º–æ—Å—Ç—ñ –ø–æ—Å–ª—É–≥–∏ |
| [03-tech-audit.md](./03-tech-audit.md) | `tech-audit.ts` | –¢–µ—Ö–Ω—ñ—á–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è |
| [04-content-optimization.md](./04-content-optimization.md) | `content-score.ts` | –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ç–µ–Ω—Ç—É |
| [05-eeat-score.md](./05-eeat-score.md) | `eeat-score.ts` | E-E-A-T –ø–æ–∫–∞–∑–Ω–∏–∫–∏ |
| [06-local-score.md](./06-local-score.md) | `local-score.ts` | –õ–æ–∫–∞–ª—å–Ω—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ |
| [07-competitor-analysis.md](./07-competitor-analysis.md) | `competitor-analysis.ts` | –ê–Ω–∞–ª—ñ–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤ |

---

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ Data Engine

```
src/server/services/engine/
‚îú‚îÄ‚îÄ index.ts                    # –ì–æ–ª–æ–≤–Ω–∏–π –µ–∫—Å–ø–æ—Ä—Ç
‚îú‚îÄ‚îÄ types.ts                    # –°–ø—ñ–ª—å–Ω—ñ —Ç–∏–ø–∏
‚îú‚îÄ‚îÄ constants.ts                # –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏, –≤–∞–≥–∏, –ø–æ—Ä–æ–≥–∏
‚îÇ
‚îú‚îÄ‚îÄ scores/
‚îÇ   ‚îú‚îÄ‚îÄ clinic-ai-score.ts      # ClinicAI Score
‚îÇ   ‚îú‚îÄ‚îÄ aiv-score.ts            # AIV Score (–ø–æ—Å–ª—É–≥–∏)
‚îÇ   ‚îú‚îÄ‚îÄ tech-score.ts           # Tech Score
‚îÇ   ‚îú‚îÄ‚îÄ content-score.ts        # Content Score
‚îÇ   ‚îú‚îÄ‚îÄ eeat-score.ts           # E-E-A-T Score
‚îÇ   ‚îî‚îÄ‚îÄ local-score.ts          # Local Score
‚îÇ
‚îú‚îÄ‚îÄ audits/
‚îÇ   ‚îú‚îÄ‚îÄ tech-audit.ts           # –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∞—É–¥–∏—Ç
‚îÇ   ‚îú‚îÄ‚îÄ html-parser.ts          # –ü–∞—Ä—Å–∏–Ω–≥ HTML
‚îÇ   ‚îú‚îÄ‚îÄ schema-analyzer.ts      # –ê–Ω–∞–ª—ñ–∑ Schema Markup
‚îÇ   ‚îî‚îÄ‚îÄ llms-analyzer.ts        # –ê–Ω–∞–ª—ñ–∑ llms.txt
‚îÇ
‚îú‚îÄ‚îÄ scanners/
‚îÇ   ‚îú‚îÄ‚îÄ ai-scanner.ts           # –°–∫–∞–Ω—É–≤–∞–Ω–Ω—è AI-–≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ domain-extractor.ts     # –í–∏—Ç—è–≥ –¥–æ–º–µ–Ω—ñ–≤
‚îÇ   ‚îî‚îÄ‚îÄ position-tracker.ts     # –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ–π
‚îÇ
‚îî‚îÄ‚îÄ analytics/
    ‚îú‚îÄ‚îÄ competitor-aggregator.ts # –ê–≥—Ä–µ–≥–∞—Ü—ñ—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤
    ‚îú‚îÄ‚îÄ visibility-calculator.ts # –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∏–¥–∏–º–æ—Å—Ç—ñ
    ‚îî‚îÄ‚îÄ gap-analyzer.ts          # Gap –∞–Ω–∞–ª—ñ–∑
```

---

## –ì–æ–ª–æ–≤–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞ —Å–∏—Å—Ç–µ–º–∏

### ClinicAI Score

```
ClinicAI Score = 0.25 √ó Visibility + 0.20 √ó Tech + 0.20 √ó Content + 0.15 √ó E-E-A-T + 0.10 √ó Local
```

### –í–∞–≥–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–∞–≥–∞ | –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç |
|-----------|------|-----------|
| Visibility | 25% | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–∏–π |
| Tech | 20% | üü† –í–∏—Å–æ–∫–∏–π |
| Content | 20% | üü† –í–∏—Å–æ–∫–∏–π |
| E-E-A-T | 15% | üü° –°–µ—Ä–µ–¥–Ω—ñ–π |
| Local | 10% | üü¢ –ë–∞–∑–æ–≤–∏–π |

**–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –≤–∞–≥:** 90% (10% –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–æ)

---

## –ü—Ä–∏–Ω—Ü–∏–ø–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

### 1. –ß–∏—Å—Ç—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

```typescript
// ‚úÖ –î–æ–±—Ä–µ ‚Äî —á–∏—Å—Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—è
function calculateScore(inputs: ScoreInputs): number {
  return inputs.a * 0.5 + inputs.b * 0.5;
}

// ‚ùå –ü–æ–≥–∞–Ω–æ ‚Äî –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ —Å—Ç–∞–Ω—É
function calculateScore(inputs: ScoreInputs): number {
  return inputs.a * globalWeight + fetchFromDB();
}
```

### 2. –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞ –≤—Ö–æ–¥—ñ

```typescript
function calculateScore(value: number): number {
  // –ó–∞–≤–∂–¥–∏ –≤–∞–ª—ñ–¥—É—î–º–æ
  if (value < 0 || value > 100) {
    throw new Error(`Value must be 0-100, got ${value}`);
  }
  
  // –õ–æ–≥—ñ–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É
  return value * 0.5;
}
```

### 3. –ë–µ–∑–ø–µ—á–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º

```typescript
function processData(data: Data | null): Result {
  // Null-safe access
  const value = data?.score ?? 0;
  
  // Empty array handling
  const items = data?.items ?? [];
  
  return calculate(value, items);
}
```

### 4. –î–æ–∫—É–º–µ–Ω—Ç–æ–≤–∞–Ω—ñ edge cases

```typescript
/**
 * –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Å–µ—Ä–µ–¥–Ω—å–æ—ó –ø–æ–∑–∏—Ü—ñ—ó
 * 
 * @edge-case –ü–æ—Ä–æ–∂–Ω—ñ–π –º–∞—Å–∏–≤ ‚Üí –ø–æ–≤–µ—Ä—Ç–∞—î null
 * @edge-case –í—Å—ñ –Ω–µ–≤–∏–¥–∏–º—ñ ‚Üí –ø–æ–≤–µ—Ä—Ç–∞—î null
 * @edge-case –ü–æ–∑–∏—Ü—ñ—è null ‚Üí —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è
 */
function calculateAveragePosition(scans: Scan[]): number | null {
  const visible = scans.filter(s => s.visible && s.position !== null);
  
  if (visible.length === 0) return null;
  
  return sum(visible.map(s => s.position!)) / visible.length;
}
```

---

## –ó–æ–≤–Ω—ñ—à–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

### API

| API | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è | –û–±–æ–≤'—è–∑–∫–æ–≤–∏–π |
|-----|-------------|--------------|
| Google PageSpeed Insights | –®–≤–∏–¥–∫—ñ—Å—Ç—å —Å–∞–π—Ç—É | –¢–∞–∫ |
| OpenAI API | AI-–∞–Ω–∞–ª—ñ–∑ | –¢–∞–∫ |
| Google Places API | GBP –¥–∞–Ω—ñ | –ù—ñ |
| Ahrefs/Semrush | Backlinks | –ù—ñ |

### –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∏

| –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|------------|-------------|
| `cheerio` | –ü–∞—Ä—Å–∏–Ω–≥ HTML |
| `zod` | –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Å—Ö–µ–º |

---

## –ú—ñ–≥—Ä–∞—Ü—ñ—è –∑—ñ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥—É

### –î–∂–µ—Ä–µ–ª–∞ –∫–æ–¥—É

| –°—Ç–∞—Ä–∏–π —à–ª—è—Ö | –ù–æ–≤–∏–π –º–æ–¥—É–ª—å |
|-------------|--------------|
| `apps/web/lib/modules/analytics/calculator.ts` | `scores/` |
| `apps/web/lib/modules/audit/` | `audits/` |
| `apps/web/lib/modules/ai/scanner.ts` | `scanners/` |
| `apps/web/lib/modules/audit/utils/` | `audits/` |

### –ß–µ–∫-–ª–∏—Å—Ç –º—ñ–≥—Ä–∞—Ü—ñ—ó

- [ ] –í–∏—Ç—è–≥–Ω—É—Ç–∏ —á–∏—Å—Ç—É –ª–æ–≥—ñ–∫—É –∑ –∫–æ–∂–Ω–æ–≥–æ —Ñ–∞–π–ª—É
- [ ] –í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ Supabase
- [ ] –í–∏–¥–∞–ª–∏—Ç–∏ React/UI –∫–æ–¥
- [ ] –î–æ–¥–∞—Ç–∏ —Ç–∏–ø–∏ TypeScript
- [ ] –ù–∞–ø–∏—Å–∞—Ç–∏ unit —Ç–µ—Å—Ç–∏
- [ ] –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ API

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç—ñ–≤

```
src/server/services/engine/__tests__/
‚îú‚îÄ‚îÄ clinic-ai-score.test.ts
‚îú‚îÄ‚îÄ aiv-score.test.ts
‚îú‚îÄ‚îÄ tech-audit.test.ts
‚îî‚îÄ‚îÄ ...
```

### –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—É

```typescript
import { calculateClinicAIScore } from '../scores/clinic-ai-score';

describe('calculateClinicAIScore', () => {
  it('should calculate correct score with valid inputs', () => {
    const result = calculateClinicAIScore({
      visibility: 80,
      tech: 70,
      content: 60,
      eeat: 50,
      local: 40
    });
    
    expect(result).toBeCloseTo(63.5, 1);
  });

  it('should throw for out-of-range values', () => {
    expect(() => calculateClinicAIScore({
      visibility: 150, // Invalid
      tech: 70,
      content: 60,
      eeat: 50,
      local: 40
    })).toThrow();
  });

  it('should handle edge case: all zeros', () => {
    const result = calculateClinicAIScore({
      visibility: 0,
      tech: 0,
      content: 0,
      eeat: 0,
      local: 0
    });
    
    expect(result).toBe(0);
  });
});
```

---

## –ö–æ–Ω—Ç—Ä–∏–±—É—Ü—ñ—è

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ—ó –º–µ—Ç—Ä–∏–∫–∏

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –Ω–∞ –æ—Å–Ω–æ–≤—ñ `_template.md`
2. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–æ–¥—É–ª—å –≤ `src/server/services/engine/`
3. –ù–∞–ø–∏—Å–∞—Ç–∏ unit —Ç–µ—Å—Ç–∏
4. –û–Ω–æ–≤–∏—Ç–∏ —Ü–µ–π README

### –ó–º—ñ–Ω–∞ —Ñ–æ—Ä–º—É–ª–∏

1. –û–Ω–æ–≤–∏—Ç–∏ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—é —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–º—É `.md` —Ñ–∞–π–ª—ñ
2. –î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å —É Changelog
3. –û–Ω–æ–≤–∏—Ç–∏ —Ç–µ—Å—Ç–∏
4. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω—ñ –º–æ–¥—É–ª—ñ

---

## Changelog

| –î–∞—Ç–∞ | –ó–º—ñ–Ω–∏ |
|------|-------|
| 2025-01-03 | –ü–æ—á–∞—Ç–∫–æ–≤–∞ –≤–µ—Ä—Å—ñ—è —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ–π –Ω–∞ –æ—Å–Ω–æ–≤—ñ Functionality.md —Ç–∞ –∞–Ω–∞–ª—ñ–∑—É –∫–æ–¥—É |

---

## –ö–æ–Ω—Ç–∞–∫—Ç–∏

–ü–∏—Ç–∞–Ω–Ω—è —â–æ–¥–æ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ–π ‚Üí —Å—Ç–≤–æ—Ä—ñ—Ç—å Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó
