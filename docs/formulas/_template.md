# [Назва метрики/модуля]

> **Модуль:** `engine/[назва-модуля].ts`  
> **Версія:** 1.0  
> **Останнє оновлення:** YYYY-MM-DD

---

## Призначення

Короткий опис того, що робить цей модуль і яку бізнес-задачу вирішує.

---

## Вхідні дані

### Обов'язкові параметри

| Параметр | Тип | Опис | Джерело |
|----------|-----|------|---------|
| `param1` | `string` | Опис параметра | DB: таблиця.поле / API / User Input |
| `param2` | `number` | Опис параметра | Розрахунок з модуля X |

### Опціональні параметри

| Параметр | Тип | Опис | Значення за замовчуванням |
|----------|-----|------|--------------------------|
| `optParam` | `boolean` | Опис | `false` |

---

## Вихідні дані

| Поле | Тип | Опис | Діапазон |
|------|-----|------|----------|
| `result` | `number` | Основний результат | 0-100 |
| `status` | `string` | Статус | 'good' \| 'poor' |

---

## Алгоритм

### Крок 1: [Назва кроку]

```
Опис логіки або псевдокод
```

### Крок 2: [Назва кроку]

```
Формула або логіка
```

### Фінальний розрахунок

```
RESULT = (component1 * weight1) + (component2 * weight2) + ...
```

---

## Формули та коефіцієнти

### Основна формула

```
Score = 0.25 * A + 0.20 * B + 0.15 * C + ...
```

### Коефіцієнти (ваги)

| Компонент | Вага | Обґрунтування |
|-----------|------|---------------|
| A | 0.25 | Найважливіший фактор |
| B | 0.20 | Другорядний фактор |

### Константи

| Константа | Значення | Опис |
|-----------|----------|------|
| `THRESHOLD_GOOD` | 600 | Поріг для рейтингу "Good" |
| `THRESHOLD_POOR` | 1000 | Поріг для рейтингу "Poor" |

---

## Edge Cases

### 1. Ділення на нуль

```typescript
if (total === 0) {
  return 0; // Або throw new Error('...')
}
```

### 2. Null/Undefined значення

```typescript
if (value === null || value === undefined) {
  return defaultValue;
}
```

### 3. Вихід за межі діапазону

```typescript
return Math.max(0, Math.min(100, calculatedValue));
```

### 4. Порожні масиви

```typescript
if (items.length === 0) {
  return { score: 0, status: 'no-data' };
}
```

---

## Залежності

### Внутрішні модулі

- `engine/module-a.ts` — для розрахунку X
- `engine/module-b.ts` — для отримання Y

### Зовнішні API

- **Google PageSpeed API** — для метрик швидкості
- **OpenAI API** — для AI-аналізу

---

## Приклади

### Приклад 1: Стандартний випадок

**Вхід:**
```typescript
{
  param1: "example.com",
  param2: 75
}
```

**Очікуваний результат:**
```typescript
{
  score: 82.5,
  status: "good"
}
```

### Приклад 2: Edge case

**Вхід:**
```typescript
{
  param1: "",
  param2: 0
}
```

**Очікуваний результат:**
```typescript
{
  score: 0,
  status: "error"
}
```

---

## Валідація

### Правила валідації вхідних даних

1. `param1` — не може бути порожнім рядком
2. `param2` — має бути в діапазоні 0-100

### Повідомлення про помилки

| Код | Повідомлення | Причина |
|-----|--------------|---------|
| `E001` | "Invalid URL format" | Невалідний URL |
| `E002` | "Score out of range" | Значення поза діапазоном |

---

## Тестування

### Unit тести

```typescript
describe('calculateMetric', () => {
  it('should return 0 when no data', () => {
    expect(calculateMetric([])).toBe(0);
  });
  
  it('should clamp values to 0-100 range', () => {
    expect(calculateMetric({value: 150})).toBe(100);
  });
});
```

### Тестові сценарії

| Сценарій | Вхід | Очікуваний вихід |
|----------|------|------------------|
| Порожні дані | `[]` | `0` |
| Максимальні значення | `{all: 100}` | `100` |
| Мінімальні значення | `{all: 0}` | `0` |

---

## Нотатки з міграції

### Що було в старому коді

- Файл: `apps/web/lib/modules/xxx/yyy.ts`
- Особливості: опис специфічної логіки

### Що змінилося

- Видалено UI-залежності
- Оптимізовано алгоритм
- Додано валідацію

---

## Changelog

| Версія | Дата | Опис змін |
|--------|------|-----------|
| 1.0 | YYYY-MM-DD | Початкова версія |
