# Расчет использования токенов для технического аудита

## Используемые модели AI

### OpenAI GPT-4o-mini
- **Модель**: gpt-4o-mini
- **Использование**: Анализ llms.txt и полный технический аудит

---

## Расчет для полного аудита клиники

### Компоненты аудита:

#### 1. AI анализ llms.txt (если файл существует)
- **Input токены**: ~2,000 токенов
  - System prompt: ~400 токенов
  - User prompt (шаблон): ~200 токенов
  - llms.txt контент: ~1,400 токенов (средний размер файла ~6,000 символов)
  
- **Output токены**: ~600 токенов
  - JSON структура: ~150 токенов
  - Summary: ~100 токенов
  - Missing sections (3-4 пункта): ~150 токенов
  - Recommendations (4-5 пунктов): ~200 токенов

- **Итого для llms.txt анализа**:
  - Input: **2,000 токенов**
  - Output: **600 токенов**
  - **Всего: 2,600 токенов**

#### 2. AI анализ технического аудита
- **Input токены**: ~2,500 токенов
  - System prompt: ~350 токенов
  - User prompt (шаблон): ~150 токенов
  - Форматированные данные аудита: ~2,000 токенов
    - Performance metrics: ~200 токенов
    - Security & Mobile: ~50 токенов
    - Core Files: ~100 токенов
    - Schema Markup: ~150 токенов
    - Meta Tags & SEO: ~200 токенов
    - Images: ~100 токенов
    - External Links: ~100 токенов
    - Duplicate Prevention: ~100 токенов
    - PageSpeed Opportunities: ~1,000 токенов (топ-5 для desktop и mobile)

- **Output токены**: ~1,000 токенов
  - JSON структура: ~200 токенов
  - Overall score + summary: ~150 токенов
  - Critical issues (3-5 пунктов): ~250 токенов
  - Priority recommendations (5-7 пунктов): ~300 токенов
  - Strengths (3-5 пунктов): ~100 токенов

- **Итого для технического аудита**:
  - Input: **2,500 токенов**
  - Output: **1,000 токенов**
  - **Всего: 3,500 токенов**

### Итого для полного аудита клиники:
- **llms.txt анализ**: 2,600 токенов (2,000 input + 600 output)
- **Технический аудит анализ**: 3,500 токенов (2,500 input + 1,000 output)
- **ОБЩЕЕ ИСПОЛЬЗОВАНИЕ ТОКЕНОВ**: **6,100 токенов**

---

## Расчет для аудита одной услуги

### Компоненты аудита:

#### AI анализ технического аудита
- **Input токены**: ~2,500 токенов
  - System prompt: ~350 токенов
  - User prompt (шаблон): ~150 токенов
  - Форматированные данные аудита: ~2,000 токенов
    - Performance metrics: ~200 токенов
    - Security & Mobile: ~50 токенов
    - Core Files: ~100 токенов (без llms.txt, так как проверяется один раз для сайта)
    - Schema Markup: ~150 токенов
    - Meta Tags & SEO: ~200 токенов
    - Images: ~100 токенов
    - External Links: ~100 токенов
    - Duplicate Prevention: ~100 токенов
    - PageSpeed Opportunities: ~1,000 токенов

- **Output токены**: ~1,000 токенов
  - JSON структура: ~200 токенов
  - Overall score + summary: ~150 токенов
  - Critical issues (3-5 пунктов): ~250 токенов
  - Priority recommendations (5-7 пунктов): ~300 токенов
  - Strengths (3-5 пунктов): ~100 токенов

- **Итого для технического аудита услуги**:
  - Input: **2,500 токенов**
  - Output: **1,000 токенов**
  - **Всего: 3,500 токенов**

### Итого для аудита услуги:
- **Технический аудит анализ**: 3,500 токенов (2,500 input + 1,000 output)
- **ОБЩЕЕ ИСПОЛЬЗОВАНИЕ ТОКЕНОВ**: **3,500 токенов**

---

## Комбинированный пакет: Полный аудит клиники + Аудит одной услуги

### Использование токенов:
- **Полный аудит клиники**: 6,100 токенов
- **Аудит услуги**: 3,500 токенов
- **ОБЩЕЕ ИСПОЛЬЗОВАНИЕ ТОКЕНОВ**: **9,600 токенов**

---

## Детальная разбивка по типам токенов

### Input токены (входящие):

#### Для llms.txt анализа:
- System prompt: ~400 токенов
- User prompt template: ~200 токенов
- llms.txt content: ~1,400 токенов (зависит от размера файла)
- **Итого input**: ~2,000 токенов

#### Для технического аудита:
- System prompt: ~350 токенов
- User prompt template: ~150 токенов
- Performance data: ~200 токенов
- Security data: ~50 токенов
- Files data: ~100 токенов
- Schema data: ~150 токенов
- Meta tags data: ~200 токенов
- Images data: ~100 токенов
- Links data: ~100 токенов
- Duplicates data: ~100 токенов
- PageSpeed opportunities: ~1,000 токенов
- **Итого input**: ~2,500 токенов

### Output токены (исходящие):

#### Для llms.txt анализа:
- JSON structure: ~150 токенов
- Score: ~10 токенов
- Summary: ~100 токенов
- Missing sections (array): ~150 токенов
- Recommendations (array): ~200 токенов
- **Итого output**: ~600 токенов

#### Для технического аудита:
- JSON structure: ~200 токенов
- Overall score: ~10 токенов
- Summary: ~150 токенов
- Critical issues (array): ~250 токенов
- Priority recommendations (array): ~300 токенов
- Strengths (array): ~100 токенов
- **Итого output**: ~1,000 токенов

---

## Масштабирование

### При аудите нескольких услуг:

#### Клиника с 5 услугами:
- Полный аудит клиники: 6,100 токенов
- 5 услуг: 5 × 3,500 = 17,500 токенов
- **Итого**: 23,600 токенов
  - Input: 14,500 токенов (2,000 + 2,500 + 5×2,500)
  - Output: 9,100 токенов (600 + 1,000 + 5×1,000)

#### Клиника с 10 услугами:
- Полный аудит клиники: 6,100 токенов
- 10 услуг: 10 × 3,500 = 35,000 токенов
- **Итого**: 41,100 токенов
  - Input: 27,000 токенов (2,000 + 2,500 + 10×2,500)
  - Output: 14,100 токенов (600 + 1,000 + 10×1,000)

#### Клиника с 20 услугами:
- Полный аудит клиники: 6,100 токенов
- 20 услуг: 20 × 3,500 = 70,000 токенов
- **Итого**: 76,100 токенов
  - Input: 52,000 токенов (2,000 + 2,500 + 20×2,500)
  - Output: 24,100 токенов (600 + 1,000 + 20×1,000)

---

## Оптимизация использования токенов

### Текущие оптимизации:
1. **llms.txt анализируется один раз** для всего сайта (не для каждой страницы)
2. **Системные промпты оптимизированы** для минимального использования токенов
3. **Форматирование данных аудита** использует компактный формат
4. **PageSpeed opportunities ограничены** топ-5 для каждого устройства

### Потенциальные оптимизации:
1. **Кэширование результатов** llms.txt анализа (если файл не изменился)
2. **Сжатие PageSpeed opportunities** (только критичные)
3. **Условный анализ** (пропускать некоторые разделы при отсутствии данных)
4. **Батчинг** нескольких услуг в один запрос (если API поддерживает)

---

## Зависимость от размера данных

### llms.txt анализ:
- **Маленький файл** (< 3,000 символов): ~1,200 input токенов
- **Средний файл** (3,000-8,000 символов): ~2,000 input токенов
- **Большой файл** (> 8,000 символов): ~3,000+ input токенов

### Технический аудит:
- **Минимальный** (мало данных): ~1,800 input токенов
- **Средний** (стандартный сайт): ~2,500 input токенов
- **Максимальный** (много opportunities, ссылок, изображений): ~3,500+ input токенов

---

## Формула расчета

### Для полного аудита клиники:
```
Total Tokens = llms_analysis_tokens + tech_audit_analysis_tokens
             = (llms_input + llms_output) + (tech_input + tech_output)
             = (2,000 + 600) + (2,500 + 1,000)
             = 6,100 токенов
```

### Для аудита одной услуги:
```
Total Tokens = tech_audit_analysis_tokens
             = tech_input + tech_output
             = 2,500 + 1,000
             = 3,500 токенов
```

### Для N услуг:
```
Total Tokens = clinic_audit_tokens + (N × service_audit_tokens)
             = 6,100 + (N × 3,500)
```

---

*Последнее обновление: Декабрь 2025*

