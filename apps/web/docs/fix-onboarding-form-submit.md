# Исправление проблемы с отправкой формы онбординга

## Проблема

Форма ввода домена в онбординге не отправлялась - кнопка "Analyze Visibility" не переходила на следующий шаг.

## Причина

Асинхронные запросы к `/api/ukraine-clinics` могли зависать или занимать слишком много времени, блокируя выполнение `onContinue`.

## Исправления

### 1. Добавлен таймаут для запросов к API клиник

**Файл:** `lib/data/ukraine-clinics.ts`

- Добавлен `AbortController` с таймаутом 5 секунд для запроса к `/api/ukraine-clinics`
- Улучшена обработка ошибок с проверкой типа ошибки (AbortError vs другие)
- Добавлено логирование для отладки

### 2. Добавлен таймаут для поиска клиники и конкурентов

**Файл:** `components/onboarding/StepDomain.tsx`

- Добавлен общий таймаут 10 секунд для операций поиска клиники и конкурентов
- Использован `Promise.race` для гарантии, что операция завершится даже при зависании
- Улучшена обработка ошибок - форма продолжает работу даже при ошибке или таймауте
- Добавлено подробное логирование на каждом этапе

### 3. Гарантирован вызов onContinue

Теперь `onContinue` вызывается в любом случае:
- ✅ При успешном поиске клиники
- ✅ При ошибке поиска
- ✅ При таймауте
- ✅ Для не-UA регионов (без поиска)

## Результат

Форма теперь всегда продолжает работу, даже если:
- API клиник недоступен
- Поиск клиники занимает слишком много времени
- Произошла ошибка при поиске

Пользователь может продолжить онбординг в любом случае, а поиск клиники - это дополнительная функция, которая не блокирует процесс.

## Тестирование

1. Откройте онбординг: `http://localhost:3000/ukr/onboarding`
2. Выберите регион: Ukraine
3. Выберите город: Київ
4. Введите домен: `lastivka.clinic`
5. Нажмите "Analyze Visibility"
6. Форма должна перейти на следующий шаг в течение 10 секунд максимум

## Логирование

Для отладки добавлены логи:
- `[StepDomain] Submitting domain:` - начало отправки формы
- `[StepDomain] Searching for clinic:` - начало поиска
- `[StepDomain] Found clinic:` - результат поиска
- `[StepDomain] Calling onContinue with:` - вызов onContinue
- `[UkraineClinics] Loading clinics data...` - загрузка данных
- `[UkraineClinics] Loaded X clinics` - успешная загрузка

Проверьте консоль браузера для отладки.




