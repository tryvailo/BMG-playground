#!/bin/bash
# –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö ESLint –æ—à–∏–±–æ–∫

set -e

echo "üöÄ –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ESLint –æ—à–∏–±–æ–∫..."
echo ""

# –®–∞–≥ 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ESLint --fix
echo "üìù –®–∞–≥ 1/3: –ó–∞–ø—É—Å–∫ ESLint --fix (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)..."
pnpm --filter web lint --fix || true
echo "‚úÖ –®–∞–≥ 1 –∑–∞–≤–µ—Ä—à–µ–Ω"
echo ""

# –®–∞–≥ 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
echo "üìù –®–∞–≥ 2/3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤..."
UNESCAPED_COUNT=$(pnpm --filter web lint 2>&1 | grep -c "can be escaped" || echo "0")
if [ "$UNESCAPED_COUNT" -gt 0 ]; then
  echo "   ‚ö†Ô∏è  –ù–∞–π–¥–µ–Ω–æ $UNESCAPED_COUNT –Ω–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤"
  echo "   üí° –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ ESLint --fix"
  echo "   üí° –û—Å—Ç–∞–≤—à–∏–µ—Å—è —Ç—Ä–µ–±—É—é—Ç —Ä—É—á–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
else
  echo "   ‚úÖ –ù–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã"
fi
echo ""

# –®–∞–≥ 3: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –æ—à–∏–±–æ–∫
echo "üìä –®–∞–≥ 3/3: –ê–Ω–∞–ª–∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –æ—à–∏–±–æ–∫..."
TOTAL=$(pnpm --filter web lint 2>&1 | grep -c "error" || echo "0")
UNUSED_VARS=$(pnpm --filter web lint 2>&1 | grep -c "is defined but never used" || echo "0")
ANY_TYPES=$(pnpm --filter web lint 2>&1 | grep -c "Unexpected any" || echo "0")
UNESCAPED=$(pnpm --filter web lint 2>&1 | grep -c "can be escaped" || echo "0")
OTHER=$((TOTAL - UNUSED_VARS - ANY_TYPES - UNESCAPED))

echo "üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"
echo "   –í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: $TOTAL"
echo "   - –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: $UNUSED_VARS"
echo "   - –¢–∏–ø—ã any: $ANY_TYPES"
echo "   - –ù–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã: $UNESCAPED"
echo "   - –î—Ä—É–≥–∏–µ: $OTHER"
echo ""

if [ "$TOTAL" -eq 0 ]; then
  echo "üéâ –í—Å–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!"
else
  echo "üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
  echo "   1. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å _ –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ"
  echo "   2. –¢–∏–ø—ã any: –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã"
  echo "   3. –ù–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã: –∑–∞–º–µ–Ω–∏—Ç–µ ' –Ω–∞ &apos; –∏ \" –Ω–∞ &quot;"
  echo ""
  echo "üìù –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π –∑–∞–ø—É—Å—Ç–∏—Ç–µ: pnpm --filter web lint"
fi



